syntax = "proto3";

package auth.v1;

option go_package = "github.com/teacinema-go/contracts/gen/go/auth/v1;authv1";

service AuthService{
  rpc SendOtp (SendOtpRequest) returns (SendOtpResponse);
  rpc VerifyOtp (VerifyOtpRequest) returns (VerifyOtpResponse);
  rpc Refresh (RefreshRequest) returns (RefreshResponse);
  rpc Logout (LogoutRequest) returns (LogoutResponse);
}

message SendOtpRequest{
  string identifier = 1;
  IdentifierType identifier_type = 2;
}

message SendOtpResponse {
  bool success = 1;
  ErrorCode error_code = 2;
  string error_message = 3;
  OtpInfo otp_info = 4;

  message OtpInfo {
    int32 expires_in_seconds = 1;
  }

  enum ErrorCode {
    INTERNAL_ERROR = 0;
    INVALID_IDENTIFIER_TYPE = 1;
    INVALID_IDENTIFIER = 2;
    ACCOUNT_ALREADY_EXISTS = 3;
  }
}


message VerifyOtpRequest{
  string identifier = 1;
  IdentifierType identifier_type = 2;
  string otp = 3;
}

message VerifyOtpResponse{
  bool success = 1;
  ErrorCode error_code = 2;
  string error_message = 3;
  AuthTokens tokens = 4;

  message AuthTokens {
    string access_token = 1;
    string refresh_token = 2;
    int32 expires_in_seconds = 3; // access_token
  }

  enum ErrorCode {
    INTERNAL_ERROR = 0;
    INVALID_IDENTIFIER_TYPE = 1;
    INVALID_IDENTIFIER = 2;
    INVALID_OTP = 3;
    EXPIRED_OTP = 4;
    ACCOUNT_ALREADY_EXISTS = 5;
  }
}

message RefreshRequest{
  string refresh_token = 1;
}

message RefreshResponse{
  bool success = 1;
  ErrorCode error_code = 2;
  string error_message = 3;
  AuthTokens tokens = 4;

  message AuthTokens {
    string access_token = 1;
    string refresh_token = 2;
    int32 expires_in_seconds = 3; // access_token
  }

  enum ErrorCode {
    INTERNAL_ERROR = 0;
    ACCOUNT_NOT_FOUND = 1;
    INVALID_REFRESH_TOKEN = 2;
    EXPIRED_REFRESH_TOKEN = 3;
  }
}

message LogoutRequest {
  string refresh_token = 1;
}

message LogoutResponse {
  bool success = 1;
  ErrorCode error_code = 2;
  string error_message = 3;

  enum ErrorCode {
    INTERNAL_ERROR = 0;
    INVALID_REFRESH_TOKEN = 1;
  }
}

enum IdentifierType {
  IDENTIFIER_TYPE_UNSPECIFIED = 0;
  PHONE = 1;
  EMAIL = 2;
}